# XojoAES

Sample code showing how to do AES256 (ECB only for now) in Xojo

See [blog post](http://kongduino.sungnyemun.org/2021/06/21/aes256-in-xojo/) for more info.

## C API

```c
void AES_init_ctx(struct AES_ctx* ctx, const uint8_t* key);
void AES_init_ctx_iv(struct AES_ctx* ctx, const uint8_t* key, const uint8_t* iv);
void AES_ctx_set_iv(struct AES_ctx* ctx, const uint8_t* iv);
int padLength(int originalLength);
void PKCS7(uint8_t* buf, int length, uint8_t b);
void AES_ECB_encrypt(const struct AES_ctx* ctx, uint8_t* buf);
void AES_ECB_decrypt(const struct AES_ctx* ctx, uint8_t* buf);
void AES_ECB_encrypt_buffer(const struct AES_ctx* ctx, uint8_t* buf, int length);
void AES_ECB_decrypt_buffer(const struct AES_ctx* ctx, uint8_t* buf, int length);
void AES_CBC_encrypt_buffer(struct AES_ctx* ctx, uint8_t* buf, uint32_t length);
void AES_CBC_decrypt_buffer(struct AES_ctx* ctx, uint8_t* buf, uint32_t length);
void AES_CTR_xcrypt_buffer(struct AES_ctx* ctx, uint8_t* buf, uint32_t length);
```

For `_buffer` functions you need to provide a buffer that's a multiple of `AES_BLOCKLEN`, ie 16, preferably properly padded. `padLength` and `PKCS7` can help with that.

## Python demo

### Basic code

```python
aes.AES_init_ctx(ctxB, keyB)
print("Key:")
hexDump(key)
print("Plaintext:")
hexDump(plainB[0:finalLength])
aes.AES_ECB_encrypt_buffer(ctxB, plainB, finalLength)
print("Encrypted:")
hexDump(plainB[0:finalLength])
aes.AES_ECB_decrypt_buffer(ctxB, plainB, finalLength)
print("Decrypted:")
hexDump(plainB[0:finalLength])
```


```
% python3 test.py


ECB
=====
 • Key:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|59 45 4c 4c 4f 57 20 53 55 42 4d 41 52 49 4e 45 | |YELLOW SUBMARINE|
01.|45 4e 49 52 41 4d 42 55 53 20 57 4f 4c 4c 45 59 | |ENIRAMBUS WOLLEY|
   +------------------------------------------------+ +----------------+
 • Plaintext:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|48 65 79 20 77 68 61 73 73 75 70 3f 20 54 68 69 | |Hey whassup? Thi|
01.|73 20 69 73 20 61 6e 20 75 6e 70 61 64 64 65 64 | |s is an unpadded|
02.|20 73 74 72 69 6e 67 21 08 08 08 08 08 08 08 08 | | string!........|
   +------------------------------------------------+ +----------------+
 • Encrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|9d 41 b3 a3 65 9a 55 0a 0a 54 67 5d 59 ff 69 00 | |.A..e.U..Tg]Y.i.|
01.|33 a8 24 07 bb 63 a4 99 70 ac 4f 9d cc 09 88 95 | |3.$..c..p.O.....|
02.|b1 65 e8 ee ce ed 22 23 43 b6 6a 26 b7 26 65 47 | |.e...."#C.j&.&eG|
   +------------------------------------------------+ +----------------+
 • Decrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|48 65 79 20 77 68 61 73 73 75 70 3f 20 54 68 69 | |Hey whassup? Thi|
01.|73 20 69 73 20 61 6e 20 75 6e 70 61 64 64 65 64 | |s is an unpadded|
02.|20 73 74 72 69 6e 67 21 08 08 08 08 08 08 08 08 | | string!........|
   +------------------------------------------------+ +----------------+
 • Encrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|9d 41 b3 a3 65 9a 55 0a 0a 54 67 5d 59 ff 69 00 | |.A..e.U..Tg]Y.i.|
01.|33 a8 24 07 bb 63 a4 99 70 ac 4f 9d cc 09 88 95 | |3.$..c..p.O.....|
02.|b1 65 e8 ee ce ed 22 23 43 b6 6a 26 b7 26 65 47 | |.e...."#C.j&.&eG|
   +------------------------------------------------+ +----------------+
 • Decrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|48 65 79 20 77 68 61 73 73 75 70 3f 20 54 68 69 | |Hey whassup? Thi|
01.|73 20 69 73 20 61 6e 20 75 6e 70 61 64 64 65 64 | |s is an unpadded|
02.|20 73 74 72 69 6e 67 21 08 08 08 08 08 08 08 08 | | string!........|
   +------------------------------------------------+ +----------------+


CBC
=====
 • Plaintext:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|48 65 79 20 77 68 61 73 73 75 70 3f 20 54 68 69 | |Hey whassup? Thi|
01.|73 20 69 73 20 61 6e 20 75 6e 70 61 64 64 65 64 | |s is an unpadded|
02.|20 73 74 72 69 6e 67 21 08 08 08 08 08 08 08 08 | | string!........|
   +------------------------------------------------+ +----------------+
 • IV:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|59 45 4c 4c 4f 57 20 53 55 42 4d 41 52 49 4e 45 | |YELLOW SUBMARINE|
01.|45 4e 49 52 41 4d 42 55 53 20 57 4f 4c 4c 45 59 | |ENIRAMBUS WOLLEY|
   +------------------------------------------------+ +----------------+
 • Encrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|1e 7a 02 11 14 5b b1 9d 15 11 83 f0 fa e9 7e b4 | |.z...[........~.|
01.|35 d7 76 08 fd ec 36 c2 34 a3 cc 05 fb d6 65 b6 | |5.v...6.4.....e.|
02.|4e 0f 58 e6 b4 f2 88 a2 9d 08 3b 54 8f 59 7b 97 | |N.X.......;T.Y{.|
   +------------------------------------------------+ +----------------+
 • Decrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|48 65 79 20 77 68 61 73 73 75 70 3f 20 54 68 69 | |Hey whassup? Thi|
01.|73 20 69 73 20 61 6e 20 75 6e 70 61 64 64 65 64 | |s is an unpadded|
02.|20 73 74 72 69 6e 67 21 08 08 08 08 08 08 08 08 | | string!........|
   +------------------------------------------------+ +----------------+

 • IV:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|59 45 4c 4c 4f 57 20 53 55 42 4d 41 52 49 4e 45 | |YELLOW SUBMARINE|
01.|45 4e 49 52 41 4d 42 55 53 20 57 4f 4c 4c 45 59 | |ENIRAMBUS WOLLEY|
   +------------------------------------------------+ +----------------+
 • Encrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|22 dd c2 0d 96 06 7b 19 fd 36 25 17 58 c0 c1 28 | |".....{..6%.X..(|
01.|af 56 0f 45 f3 19 cd 1b 17 87 0f 44 dc e1 f8 aa | |.V.E.......D....|
02.|3a 6e 72 96 f2 eb f6 8a dd f3 e0 ca 48 37 68 74 | |:nr.........H7ht|
   +------------------------------------------------+ +----------------+
 • Decrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|48 65 79 20 77 68 61 73 73 75 70 3f 20 54 68 69 | |Hey whassup? Thi|
01.|73 20 69 73 20 61 6e 20 75 6e 70 61 64 64 65 64 | |s is an unpadded|
02.|20 73 74 72 69 6e 67 21 08 08 08 08 08 08 08 08 | | string!........|
   +------------------------------------------------+ +----------------+

CTR
=====
 • Plaintext:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|48 65 79 20 77 68 61 73 73 75 70 3f 20 54 68 69 | |Hey whassup? Thi|
01.|73 20 69 73 20 61 6e 20 75 6e 70 61 64 64 65 64 | |s is an unpadded|
02.|20 73 74 72 69 6e 67 21 08 08 08 08 08 08 08 08 | | string!........|
   +------------------------------------------------+ +----------------+

 • IV:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|59 45 4c 4c 4f 57 20 53 55 42 4d 41 52 49 4e 45 | |YELLOW SUBMARINE|
01.|45 4e 49 52 41 4d 42 55 53 20 57 4f 4c 4c 45 59 | |ENIRAMBUS WOLLEY|
   +------------------------------------------------+ +----------------+
 • Encrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|d6 05 c1 48 45 16 52 4c 5a df ca 6f d7 9c b4 14 | |...HE.RLZ..o....|
01.|4f a3 fc d0 d8 45 8d c3 41 ab 9d e8 c6 03 fe 42 | |O....E..A......B|
02.|bb d3 69 87 97 a4 0d 65 a2 09 9a 97 7c 23 86 6f | |..i....e....|#.o|
   +------------------------------------------------+ +----------------+
 • Decrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|48 65 79 20 77 68 61 73 73 75 70 3f 20 54 68 69 | |Hey whassup? Thi|
01.|73 20 69 73 20 61 6e 20 75 6e 70 61 64 64 65 64 | |s is an unpadded|
02.|20 73 74 72 69 6e 67 21 08 08 08 08 08 08 08 08 | | string!........|
   +------------------------------------------------+ +----------------+

 • IV:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|59 45 4c 4c 4f 57 20 53 55 42 4d 41 52 49 4e 45 | |YELLOW SUBMARINE|
01.|45 4e 49 52 41 4d 42 55 53 20 57 4f 4c 4c 45 59 | |ENIRAMBUS WOLLEY|
   +------------------------------------------------+ +----------------+
 • Encrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|1e 0f 44 7e 3b 0f 00 4d 9f 4a 5a a7 fe 10 09 a2 | |..D~;..M.JZ.....|
01.|be 37 ce 54 e8 59 e3 0c ad 3b df 6b 3b 62 56 ee | |.7.T.Y...;.k;bV.|
02.|c5 3a 6b 70 fe ea 5f 5f df 35 63 9a 32 17 d4 f3 | |.:kp..__.5c.2...|
   +------------------------------------------------+ +----------------+
 • Decrypted:
   +------------------------------------------------+ +----------------+
   |.0 .1 .2 .3 .4 .5 .6 .7 .8 .9 .a .b .c .d .e .f | |      ASCII     |
   +------------------------------------------------+ +----------------+
00.|48 65 79 20 77 68 61 73 73 75 70 3f 20 54 68 69 | |Hey whassup? Thi|
01.|73 20 69 73 20 61 6e 20 75 6e 70 61 64 64 65 64 | |s is an unpadded|
02.|20 73 74 72 69 6e 67 21 08 08 08 08 08 08 08 08 | | string!........|
   +------------------------------------------------+ +----------------+

See? With CBC/CTR the cipher is different every time.See? With CBC the cipher is different every time.
```

# Don't use ECB though...

As you can see, the cipher with ECB is always the same, whereas with CBC and CTR it changes every time, preventing the [easier attacks on the cipher](https://cryptopals.com/sets/2).